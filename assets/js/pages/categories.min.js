"use strict";App.Pages.Categories=function(){function addEventListeners(){$categories.on("submit","#filter-categories form",function(event){event.preventDefault();var key=$("#filter-categories .key").val();$(".selected").removeClass("selected"),resetForm(),filter(key)}),$categories.on("click",".category-row",function(event){if($("#filter-categories .filter").prop("disabled"))return void $("#filter-categories .results").css("color","#AAA");var categoryId=$(event.currentTarget).attr("data-id"),category=filterResults.find(function(filterResult){return+filterResult.id===+categoryId});display(category),$("#filter-categories .selected").removeClass("selected"),$(event.currentTarget).addClass("selected"),$("#edit-category, #delete-category").prop("disabled",!1)}),$categories.on("click","#add-category",function(){resetForm(),$categories.find(".add-edit-delete-group").hide(),$categories.find(".save-cancel-group").show(),$categories.find(".record-details").find("input, select, textarea").prop("disabled",!1),$categories.find(".record-details .form-label span").prop("hidden",!1),$filterCategories.find("button").prop("disabled",!0),$filterCategories.find(".results").css("color","#AAA")}),$categories.on("click","#edit-category",function(){$categories.find(".add-edit-delete-group").hide(),$categories.find(".save-cancel-group").show(),$categories.find(".record-details").find("input, select, textarea").prop("disabled",!1),$categories.find(".record-details .form-label span").prop("hidden",!1),$filterCategories.find("button").prop("disabled",!0),$filterCategories.find(".results").css("color","#AAA")}),$categories.on("click","#delete-category",function(){var categoryId=$id.val(),buttons=[{text:lang("cancel"),click:function click(event,messageModal){messageModal.dispose()}},{text:lang("delete"),click:function click(event,messageModal){remove(categoryId),messageModal.dispose()}}];App.Utils.Message.show(lang("delete_category"),lang("delete_record_prompt"),buttons)}),$categories.on("click","#save-category",function(){var category={name:$name.val(),description:$description.val()};""!==$id.val()&&(category.id=$id.val()),validate()&&save(category)}),$categories.on("click","#cancel-category",function(){var id=$id.val();resetForm(),""!==id&&select(id,!0)})}function filter(keyword){var selectId=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,show=!!(2<arguments.length&&void 0!==arguments[2])&&arguments[2];App.Http.Categories.search(keyword,filterLimit).then(function(response){filterResults=response,$("#filter-categories .results").empty(),response.forEach(function(category){$("#filter-categories .results").append(getFilterHtml(category)).append($("<hr/>"))}),0===response.length?$("#filter-categories .results").append($("<em/>",{text:lang("no_records_found")})):response.length===filterLimit&&$("<button/>",{type:"button",class:"btn btn-outline-secondary w-100 load-more text-center",text:lang("load_more"),click:function click(){filterLimit+=20,filter(keyword,selectId,show)}}).appendTo("#filter-categories .results"),selectId&&select(selectId,show)})}function save(category){App.Http.Categories.save(category).then(function(response){App.Layouts.Backend.displayNotification(lang("category_saved")),resetForm(),$filterCategories.find(".key").val(""),filter("",response.id,!0)})}function remove(id){App.Http.Categories.destroy(id).then(function(){App.Layouts.Backend.displayNotification(lang("category_deleted")),resetForm(),filter($("#filter-categories .key").val())})}function display(category){$id.val(category.id),$name.val(category.name),$description.val(category.description)}function validate(){$categories.find(".is-invalid").removeClass("is-invalid"),$categories.find(".form-message").removeClass("alert-danger").hide();try{var missingRequired=!1;if($categories.find(".required").each(function(index,fieldEl){$(fieldEl).val()||($(fieldEl).addClass("is-invalid"),missingRequired=!0)}),missingRequired)throw new Error(lang("fields_are_required"));return!0}catch(error){return $categories.find(".form-message").addClass("alert-danger").text(error.message).show(),!1}}function resetForm(){$filterCategories.find(".selected").removeClass("selected"),$filterCategories.find("button").prop("disabled",!1),$filterCategories.find(".results").css("color",""),$categories.find(".add-edit-delete-group").show(),$categories.find(".save-cancel-group").hide(),$categories.find(".record-details").find("input, select, textarea").val("").prop("disabled",!0),$categories.find(".record-details .form-label span").prop("hidden",!0),$("#edit-category, #delete-category").prop("disabled",!0),$categories.find(".record-details .is-invalid").removeClass("is-invalid"),$categories.find(".record-details .form-message").hide()}function getFilterHtml(category){return $("<div/>",{class:"category-row entry","data-id":category.id,html:[$("<strong/>",{text:category.name}),$("<br/>")]})}function select(id){var show=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];if($filterCategories.find(".selected").removeClass("selected"),$filterCategories.find(".category-row[data-id=\""+id+"\"]").addClass("selected"),show){var category=filterResults.find(function(category){return+category.id===+id});display(category),$("#edit-category, #delete-category").prop("disabled",!1)}}var $categories=$("#categories"),$filterCategories=$("#filter-categories"),$id=$("#id"),$name=$("#name"),$description=$("#description"),filterResults={},filterLimit=20;return document.addEventListener("DOMContentLoaded",function(){resetForm(),filter(""),addEventListeners()}),{filter:filter,save:save,remove:remove,getFilterHtml:getFilterHtml,resetForm:resetForm,select:select}}();