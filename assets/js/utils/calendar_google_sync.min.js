"use strict";App.Utils.CalendarGoogleSync=function(){function addEventListeners(){$("#enable-sync").on("click",function(){if(!1===$("#enable-sync").hasClass("enabled"))var authUrl=App.Utils.Url.siteUrl("google/oauth/"+$("#select-filter-item").val()),redirectUrl=App.Utils.Url.siteUrl("google/oauth_callback"),windowHandle=window.open(authUrl,"Authorize Easy!Appointments","width=800, height=600"),authInterval=window.setInterval(function(){try{if(windowHandle.document&&-1!==windowHandle.document.URL.indexOf(redirectUrl)){windowHandle.close(),window.clearInterval(authInterval),$("#enable-sync").addClass("btn-secondary enabled").removeClass("btn-light"),$("#enable-sync span").text(lang("disable_sync")),$("#google-sync").prop("disabled",!1),$("#select-filter-item option:selected").attr("google-sync","true");var providerId=$("#select-filter-item").val();App.Http.Google.getGoogleCalendars(providerId).done(function(response){$("#google-calendar").empty(),response.forEach(function(calendar){$("#google-calendar").append(new Option(calendar.summary,calendar.id))}),$("#select-google-calendar").modal("show")})}}catch(Error){}},100);else{var buttons=[{text:lang("cancel"),click:function click(event,messageModal){messageModal.dispose()}},{text:"OK",click:function click(event,messageModal){var providerId=$("#select-filter-item").val(),provider=vars("available_providers").find(function(availableProvider){return+availableProvider.id===+providerId});if(!provider)throw new Error("Provider not found: "+providerId);provider.settings.google_sync="0",provider.settings.google_token=null,App.Http.Google.disableProviderSync(provider.id),$("#enable-sync").removeClass("btn-secondary enabled").addClass("btn-light"),$("#enable-sync span").text(lang("enable_sync")),$("#google-sync").prop("disabled",!0),$("#select-filter-item option:selected").attr("google-sync","false"),messageModal.dispose()}}];App.Utils.Message.show(lang("disable_sync"),lang("disable_sync_prompt"),buttons)}}),$("#select-calendar").on("click",function(){var providerId=$("#select-filter-item").val(),calendarId=$("#google-calendar").val();App.Http.Google.selectGoogleCalendar(providerId,calendarId).done(function(){App.Layouts.Backend.displayNotification(lang("google_calendar_selected")),$("#select-google-calendar").modal("hide")})}),$("#google-sync").on("click",function(){var providerId=$selectFilterItem.val();App.Http.Google.syncWithGoogle(providerId).done(function(){App.Layouts.Backend.displayNotification(lang("google_sync_completed")),$("#reload-appointments").trigger("click")}).fail(function(){App.Layouts.Backend.displayNotification(lang("google_sync_failed"))})})}function initialize(){addEventListeners()}var $selectFilterItem=$("#select-filter-item");return document.addEventListener("DOMContentLoaded",initialize),{initialize:initialize}}();